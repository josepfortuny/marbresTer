function t(t,e,r,n){return!/^(__proto__|constructor|prototype)$/.test(e)&&((e=e.split?e.split("."):e.slice(0)).slice(0,-1).reduce((function(t,e){return t[e]=t[e]||{}}),t)[e.pop()]=r),t}function e(t,e){return null!=t?t:e}function r(t,r,n,o){return e(e(n[r],o[r]),t)}function n(e){var n=e||{};return function(e){var o=function(){try{return e.options.persistedState||{}}catch(t){return{}}}();if(!1!==r(!0,"persist",o,n)){var i,s=r(e.store.$id,"key",o,{}),c=r(!1,"overwrite",o,n),u=r(function(){try{return window.localStorage}catch(t){return{getItem:function(){},setItem:function(){},removeItem:function(){}}}}(),"storage",o,n),a=r((function(){return!0}),"filter",o,n),f=r(JSON.stringify,"serialize",o,n),p=r(JSON.parse,"deserialize",o,n),d=r((function(t){return t}),"migrate",o,{}),l=r((function(t,e){return e}),"merge",o,{});"production"!==process.env.NODE_ENV&&(void 0===o.assertStorage&&(o.assertStorage=function(t){var e=t.setItem("@@","1"),r=function(){t.removeItem("@@")};e instanceof Promise?e.then(r):r()}),o.assertStorage(u));var v=new Promise((function(t){i=t})),m=0;e.store.$persistedState={isReady:function(){return v},pending:!1};try{var g=u.getItem(s);g instanceof Promise?g.then(y):y(g)}catch(t){"production"!==process.env.NODE_ENV&&console.warn(t),i()}e.store.$subscribe((function(r,n){if(!1!==a(r,n)){Array.isArray(o.includePaths)&&(n=o.includePaths.reduce((function(e,r){return t(e,r,function(t,e,r){return void 0===(t=(e.split?e.split("."):e).reduce((function(t,e){return t&&t[e]}),t))?r:t}(n,r))}),{})),Array.isArray(o.excludePaths)&&(n=p(f(n)),o.excludePaths.forEach((function(e){return t(n,e,void 0)}),{}));var i=f(n),c=u.setItem(s,i);c instanceof Promise&&(++m,e.store.$persistedState.pending=0!==m,c.catch((function(){})).finally((function(){--m,e.store.$persistedState.pending=0!==m})))}}))}function h(t){(o.beforeHydrate||function(){})(e.store.$state);var r=l(e.store.$state,t);c?e.store.$state=r:e.store.$patch(r),i()}function y(t){if(null!=t){var e=p(t),r=d(e);r instanceof Promise?r.then(h):h(r)}else i()}}}export{n as createPersistedStatePlugin};
